# Telephone Exchange System (АТС)

Клиент-серверная система симуляции телефонной АТС на C# с WPF интерфейсом.

## Описание

Система позволяет множеству абонентов подключаться к серверу, совершать и принимать вызовы, а также обмениваться текстовыми сообщениями во время разговора. Реализована полная симуляция работы телефонной станции с управлением состояниями абонентов и ограничением количества одновременных соединений.

## Параметры системы
- **Количество абонентов:** 7 (2N-1, где N=4)
- **Лимит соединений АТС:** 4 одновременных соединения (2K, где K=2)
- **Длина телефонного номера:** 3 цифры (001-999)
- **Порт сервера:** 5000 (по умолчанию)

## Структура проекта
```
TelephoneExchange/
├── TelephoneExchange.Server/    # Серверное консольное приложение
│   ├── Models/                  # Модели данных (Subscriber, Connection)
│   ├── Network/                 # Сетевая логика (ATS, ClientHandler)
│   └── config.json             # Конфигурация сервера
├── TelephoneExchange.Client/    # Клиентское WPF приложение
│   ├── Models/                  # Модели данных (SubscriberInfo)
│   ├── Network/                 # Сетевая логика (PhoneClient)
│   └── MainWindow.xaml         # Интерфейс клиента
└── docs/                        # Документация и диаграммы
    ├── DOCUMENTATION.md         # Полная документация
    ├── TASKS.md                # Техническое задание
    └── diagrams/               # UML диаграммы (PlantUML)
```

## Технологии
- **C# .NET 9.0**
- **WPF** (Windows Presentation Foundation)
- **TCP Sockets** (асинхронное взаимодействие)
- **JSON** (конфигурация и передача данных)

## Быстрый старт

### Требования
- .NET 9.0 SDK или выше
- Windows (для WPF клиента)

### Запуск сервера
```bash
dotnet run --project TelephoneExchange.Server/TelephoneExchange.Server.csproj
```

### Запуск клиента
```bash
dotnet run --project TelephoneExchange.Client/TelephoneExchange.Client.csproj
```

### Сборка проекта
```bash
dotnet build TelephoneExchange.sln
```

## Использование

1. **Запустите сервер** — он начнёт прослушивать порт 5000
2. **Запустите несколько клиентов** — каждому будет присвоен уникальный номер
3. **Подключитесь к серверу** — введите адрес `127.0.0.1:5000` и нажмите "Подключиться"
4. **Совершите вызов:**
   - Снимите трубку (получите сигнал "Готов")
   - Введите номер другого абонента
   - Нажмите "Позвонить"
5. **Примите вызов** — в другом клиенте снимите трубку при входящем вызове
6. **Обменивайтесь сообщениями** — используйте чат во время разговора
7. **Завершите вызов** — положите трубку

## Состояния абонента

- **Idle** — ожидание (трубка положена)
- **Ready** — готов к набору (трубка снята, есть свободные линии)
- **Busy** — занято (трубка снята, нет свободных линий)
- **Dialing** — набор номера (вызывает другого абонента)
- **Ringing** — входящий вызов (кто-то звонит)
- **InCall** — в разговоре (соединение установлено)

## Протокол обмена

### Команды клиент → сервер
- `CONNECT` — подключение к серверу
- `PICKUP` — снять трубку
- `HANGUP` — положить трубку
- `DIAL:<номер>` — набрать номер
- `MESSAGE:<текст>` — отправить сообщение

### Сообщения сервер → клиент
- `ASSIGNED:<номер>` — присвоен номер
- `SIGNAL:готов/занято` — сигнал АТС
- `STATE:<состояние>` — изменение состояния
- `INCOMING_CALL:<номер>` — входящий вызов
- `CALL_CONNECTED` — соединение установлено
- `CALL_ENDED` — соединение разорвано
- `MESSAGE:<текст>` — входящее сообщение
- `SUBSCRIBERS:<json>` — список абонентов
- `ERROR:<текст>` — ошибка

## Документация

- [Полная документация](docs/DOCUMENTATION.md) — описание архитектуры, классов и примеры использования
- [Диаграммы](docs/diagrams/) — ER-диаграмма, диаграмма классов, диаграмма последовательности (PlantUML)

## Конфигурация

Отредактируйте `TelephoneExchange.Server/config.json`:

```json
{
  "MaxConnections": 4,
  "PhoneNumberLength": 3,
  "ServerPort": 5000
}
```