# Руководство по тестированию системы мини-АТС

## Подготовка к тестированию

### 1. Сборка проекта
```bash
dotnet build TelephoneExchange.sln
```

Убедитесь, что сборка прошла успешно без ошибок.

### 2. Проверка конфигурации
Откройте `TelephoneExchange.Server/config.json` и убедитесь в корректности параметров:
```json
{
  "MaxConnections": 4,
  "PhoneNumberLength": 3,
  "ServerPort": 5000
}
```

---

## Тест 1: Запуск сервера

### Цель
Проверить, что сервер успешно запускается и готов принимать подключения.

### Шаги
1. Откройте терминал в корне проекта
2. Выполните команду:
   ```bash
   dotnet run --project TelephoneExchange.Server/TelephoneExchange.Server.csproj
   ```

### Ожидаемый результат
```
=== Мини-АТС Сервер ===
Конфигурация загружена: MaxConnections=4, PhoneNumberLength=3
Сервер запущен на порту 5000
Ожидание подключений...
```

### Критерии успеха
- [x] Сервер запустился без ошибок
- [x] Конфигурация загружена корректно
- [x] Порт 5000 прослушивается

---

## Тест 2: Подключение одного клиента

### Цель
Проверить подключение клиента к серверу и присвоение номера.

### Шаги
1. Оставьте сервер запущенным
2. Откройте новый терминал
3. Выполните команду:
   ```bash
   dotnet run --project TelephoneExchange.Client/TelephoneExchange.Client.csproj
   ```
4. В открывшемся окне нажмите "Подключиться"

### Ожидаемый результат

**В клиенте:**
- Статус изменится на "Подключен" (зелёный)
- В поле "Мой номер" появится "001"
- В списке абонентов появится "Номер: 001 - Состояние: Idle"

**В консоли сервера:**
```
Подключился клиент 127.0.0.1:XXXXX
Абоненту присвоен номер 001
```

### Критерии успеха
- [x] Клиент успешно подключился
- [x] Присвоен номер 001
- [x] Состояние отображается корректно
- [x] Сервер зарегистрировал подключение

---

## Тест 3: Подключение нескольких клиентов

### Цель
Проверить одновременное подключение нескольких абонентов.

### Шаги
1. Запустите ещё 2 экземпляра клиента (всего 3)
2. Подключите их к серверу

### Ожидаемый результат

**Клиент 1:** номер 001  
**Клиент 2:** номер 002  
**Клиент 3:** номер 003

В каждом клиенте в списке абонентов должны отображаться все три абонента с состоянием Idle.

### Критерии успеха
- [x] Все клиенты получили уникальные номера
- [x] Каждый клиент видит полный список абонентов
- [x] Номера генерируются последовательно

---

## Тест 4: Успешный вызов

### Цель
Проверить полный цикл вызова: инициация, установление соединения, обмен сообщениями, завершение.

### Предусловия
- Сервер запущен
- Подключены клиенты 001 и 002

### Шаги

#### 4.1 Инициация вызова (Клиент 001)
1. Нажмите "Снять трубку"
2. Проверьте сигнал: должно появиться "готов"
3. Проверьте состояние: должно измениться на "Ready"
4. Введите номер "002" в поле "Набрать номер"
5. Нажмите "Позвонить"

**Ожидаемый результат:**
- Состояние изменится на "Dialing"
- В консоли сервера: `Вызов: 001 -> 002`

#### 4.2 Входящий вызов (Клиент 002)
**Ожидаемый результат:**
- Появится MessageBox "Входящий вызов от 001"
- Состояние изменится на "Ringing"

#### 4.3 Принятие вызова (Клиент 002)
1. Закройте MessageBox
2. Нажмите "Снять трубку"

**Ожидаемый результат:**
- Оба клиента перейдут в состояние "InCall"
- Чат активируется в обоих клиентах
- В консоли сервера: `Соединение установлено: 001 <-> 002`

#### 4.4 Обмен сообщениями
1. В клиенте 001 введите "Привет" и нажмите "Отправить"
2. В клиенте 002 введите "Привет!" и нажмите "Отправить"

**Ожидаемый результат:**
- В клиенте 001:
  ```
  Я: Привет
  Собеседник: Привет!
  ```
- В клиенте 002:
  ```
  Собеседник: Привет
  Я: Привет!
  ```

#### 4.5 Завершение вызова (Клиент 001)
1. Нажмите "Положить трубку"

**Ожидаемый результат:**
- Оба клиента вернутся в состояние "Idle"
- Чат очистится и деактивируется в обоих клиентах
- В консоли сервера: `Соединение разорвано: 001 <-> 002`

### Критерии успеха
- [x] Вызов инициирован корректно
- [x] Входящий вызов отображён
- [x] Соединение установлено
- [x] Сообщения доставлены в обе стороны
- [x] Соединение корректно разорвано
- [x] Состояния обновлены правильно

---

## Тест 5: Лимит соединений

### Цель
Проверить ограничение количества одновременных соединений.

### Предусловия
- Сервер запущен с MaxConnections = 4
- Подключены клиенты 001-009 (9 клиентов)

### Шаги

#### 5.1 Установка максимального количества соединений
1. Установите соединения:
   - 001 → 002
   - 003 → 004
   - 005 → 006
   - 007 → 008

**Ожидаемый результат:**
- Все 4 соединения установлены успешно
- 8 абонентов в состоянии "InCall"

#### 5.2 Попытка превысить лимит
1. В клиенте 009 нажмите "Снять трубку"

**Ожидаемый результат:**
- Сигнал: "занято"
- Состояние: "Busy"
- Кнопка "Позвонить" неактивна

#### 5.3 Освобождение линии
1. В клиенте 001 нажмите "Положить трубку"

**Ожидаемый результат:**
- Соединение 001-002 разорвано
- Активных соединений: 3

#### 5.4 Повторная попытка
1. В клиенте 009 нажмите "Положить трубку" (вернуться в Idle)
2. Нажмите "Снять трубку"

**Ожидаемый результат:**
- Сигнал: "готов"
- Состояние: "Ready"
- Кнопка "Позвонить" активна
- Можно совершить вызов

### Критерии успеха
- [x] Лимит соединений работает корректно
- [x] При достижении лимита новые абоненты получают сигнал "занято"
- [x] После освобождения линии можно совершить вызов
- [x] Счётчик активных соединений работает правильно

---

## Тест 6: Вызов несуществующего номера

### Цель
Проверить обработку ошибки при наборе несуществующего номера.

### Предусловия
- Сервер запущен
- Подключен клиент 001

### Шаги
1. Нажмите "Снять трубку"
2. Введите номер "999"
3. Нажмите "Позвонить"

### Ожидаемый результат
- Появится MessageBox с текстом "Номер не найден"
- Состояние останется "Ready"
- Можно повторить попытку с другим номером

### Критерии успеха
- [x] Ошибка обработана корректно
- [x] Пользователь информирован
- [x] Состояние не изменилось
- [x] Система остаётся работоспособной

---

## Тест 7: Вызов занятого абонента

### Цель
Проверить обработку попытки вызвать абонента, который уже разговаривает.

### Предусловия
- Сервер запущен
- Подключены клиенты 001, 002, 003
- Установлено соединение 001 ↔ 002

### Шаги
1. В клиенте 003 нажмите "Снять трубку"
2. Введите номер "001"
3. Нажмите "Позвонить"

### Ожидаемый результат
- Появится MessageBox с текстом "Абонент занят"
- Состояние клиента 003 останется "Ready"
- Соединение 001-002 не нарушено

### Критерии успеха
- [x] Ошибка обработана корректно
- [x] Пользователь информирован
- [x] Состояние не изменилось
- [x] Существующее соединение не нарушено

---

## Тест 8: Отключение клиента во время разговора

### Цель
Проверить корректное завершение соединения при аварийном отключении клиента.

### Предусловия
- Сервер запущен
- Подключены клиенты 001 и 002
- Установлено соединение 001 ↔ 002

### Шаги
1. Закройте окно клиента 001 (крестик в углу окна)

### Ожидаемый результат

**В клиенте 002:**
- Соединение разорвано
- Состояние изменится на "Idle"
- Чат очистится

**В консоли сервера:**
```
Соединение разорвано: 001 <-> 002
Клиент отключился 001
```

### Критерии успеха
- [x] Соединение корректно разорвано
- [x] Второй абонент уведомлён
- [x] Ресурсы освобождены
- [x] Сервер остаётся работоспособным

---

## Тест 9: Обновление списка абонентов

### Цель
Проверить, что все клиенты видят актуальное состояние всех абонентов в реальном времени.

### Предусловия
- Сервер запущен
- Подключены клиенты 001, 002, 003

### Шаги
1. В клиенте 001 снимите трубку
2. Проверьте список абонентов во всех клиентах

### Ожидаемый результат
Во всех трёх клиентах список должен обновиться:
```
Номер: 001 - Состояние: Ready
Номер: 002 - Состояние: Idle
Номер: 003 - Состояние: Idle
```

3. В клиенте 001 наберите 002 и позвоните
4. В клиенте 002 примите вызов
5. Проверьте список абонентов во всех клиентах

### Ожидаемый результат
```
Номер: 001 - Состояние: InCall
Номер: 002 - Состояние: InCall
Номер: 003 - Состояние: Idle
```

### Критерии успеха
- [x] Список обновляется после каждого изменения состояния
- [x] Все клиенты видят одинаковую информацию
- [x] Обновления происходят в реальном времени

---

## Тест 10: Graceful Shutdown сервера

### Цель
Проверить корректное завершение работы сервера.

### Предусловия
- Сервер запущен
- Подключены несколько клиентов

### Шаги
1. В консоли сервера нажмите Ctrl+C

### Ожидаемый результат

**В консоли сервера:**
```
Остановка сервера...
Сервер остановлен
```

**В клиентах:**
- Статус изменится на "Отключен"
- Появится сообщение об ошибке подключения

### Критерии успеха
- [x] Сервер корректно завершает работу
- [x] Все соединения закрыты
- [x] Клиенты уведомлены об отключении

---

## Чек-лист полного тестирования

### Функциональные тесты
- [ ] Тест 1: Запуск сервера
- [ ] Тест 2: Подключение одного клиента
- [ ] Тест 3: Подключение нескольких клиентов
- [ ] Тест 4: Успешный вызов
- [ ] Тест 5: Лимит соединений
- [ ] Тест 6: Вызов несуществующего номера
- [ ] Тест 7: Вызов занятого абонента
- [ ] Тест 8: Отключение клиента во время разговора
- [ ] Тест 9: Обновление списка абонентов
- [ ] Тест 10: Graceful Shutdown сервера

### Дополнительные проверки
- [ ] Интерфейс клиента адаптивен (изменение размера окна)
- [ ] Кнопки активны/неактивны в соответствии с состоянием
- [ ] Все сообщения отображаются корректно
- [ ] Нет утечек памяти при длительной работе
- [ ] Сервер обрабатывает множественные подключения без задержек

---

## Известные ограничения

1. **Платформа:** Клиент работает только на Windows (WPF)
2. **Сеть:** Клиент и сервер должны быть в одной сети или использовать localhost
3. **Безопасность:** Нет аутентификации и шифрования данных
4. **Масштабируемость:** Система рассчитана на небольшое количество абонентов

---

## Отчёт о тестировании

После завершения тестирования заполните:

**Дата тестирования:** _______________  
**Тестировщик:** _______________  
**Версия:** _______________

**Результаты:**
- Пройдено тестов: ___ / 10
- Найдено критических ошибок: ___
- Найдено некритических ошибок: ___

**Комментарии:**
_______________________________________________
_______________________________________________
_______________________________________________
